---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import TilsLists from "@/components/til/TilList.astro";
import Pagination from "@/components/shared/Pagination.astro";
import { paginate, parsePageFromQuery, getPaginationInfo } from "@/utils/pagination";

const allTils = (await getCollection("tils"))
  // Order by newest, `data.publishedAt` is a Date object
  // @ts-ignore
  .sort((a, b) => b.data.publishedAt - a.data.publishedAt);

const currentPage = parsePageFromQuery(Astro.url);
const paginationResult = paginate(allTils, { page: currentPage, itemsPerPage: 12 });
const paginationInfo = getPaginationInfo(paginationResult);
const tils = paginationResult.items;
---

<Layout title="All tils">
  <div class="space-y-16 py-8">
    <!-- Page Header with gradient -->
    <section class="relative space-y-8">
      <!-- Header background glow -->
      <div class="absolute inset-0 bg-gradient-to-r from-indigo-500/20 via-violet-500/20 to-purple-500/20 rounded-3xl blur-3xl"></div>
      
      <div class="relative text-center space-y-4">
        <h1 class="text-3xl font-bold text-white sm:text-4xl lg:text-5xl">
          Today I Learned
        </h1>
        <div class="h-1 w-20 bg-gradient-to-r from-indigo-400 to-violet-400 rounded-full mx-auto"></div>
        <p class="text-lg text-slate-300 max-w-2xl mx-auto">
          Quick insights and learnings from my daily development journey.
        </p>
        {paginationResult.totalPages > 1 && (
          <p class="text-sm text-slate-400">
            Showing {paginationInfo.startItem}-{paginationInfo.endItem} of {paginationInfo.totalItems} TILs
          </p>
        )}
      </div>
    </section>

    <!-- TIL Content -->
    <section class="relative">
      <div class="absolute inset-0 bg-gradient-to-r from-violet-500/10 to-indigo-500/10 rounded-3xl blur-2xl"></div>
      <div class="relative">
        <TilsLists tils={tils} />
        <Pagination 
          currentPage={paginationResult.currentPage}
          totalPages={paginationResult.totalPages}
          baseUrl="/til"
        />
      </div>
    </section>
  </div>
</Layout>
