---
import removeTrailingSlash from "@/utils/removeTrailingSlash";
import presentation from "@/data/presentation";

const pathname = removeTrailingSlash(Astro.url.pathname);
const notInHome = pathname !== "/";
---

<header class="flex w-full items-center justify-between py-3 sm:py-4">
  <!-- Logo/Brand with Apple-style gradient text -->
  <div class="flex items-center">
    {
      notInHome ? (
        <a 
          href="/" 
          class="text-xl font-bold bg-gradient-to-r from-indigo-400 via-purple-400 to-violet-400 bg-clip-text text-transparent hover:from-indigo-300 hover:via-purple-300 hover:to-violet-300 transition-all duration-300 ease-out"
          aria-current={pathname === "/" ? "page" : undefined}
        >
          Mahmudul
        </a>
      ) : (
        <a 
          href={`mailto:${presentation.mail}`} 
          class="text-lg font-medium text-gray-300 hover:text-white transition-all duration-300 ease-out relative group"
        >
          {presentation.mail}
          <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-indigo-400 to-purple-400 transition-all duration-300 ease-out group-hover:w-full"></span>
        </a>
      )
    }
  </div>

  <!-- Navigation with Apple glassmorphism -->
  <nav class="hidden md:block" role="navigation" aria-label="Primary">
    <ul role="list" class="flex items-center space-x-8">
      <li>
        <a
          href="/"
          class:list={{
            ["text-white font-medium relative transition-all duration-300 ease-out focus:outline-none"]: pathname === "/",
            ["text-gray-300 hover:text-white transition-all duration-300 ease-out relative group focus:outline-none"]: pathname !== "/",
          }}
          aria-current={pathname === "/" ? "page" : undefined}
        >
          Home
          <span class:list={{
            ["absolute -bottom-1 left-0 w-full h-0.5 bg-gradient-to-r from-indigo-400 to-purple-400 transition-all duration-300 ease-out"]: pathname === "/",
            ["absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-indigo-400 to-purple-400 transition-all duration-300 ease-out group-hover:w-full"]: pathname !== "/",
          }}></span>
          <!-- Cool border glow effect -->
          <span class:list={{
            ["absolute -bottom-1 left-0 w-full h-0.5 bg-gradient-to-r from-indigo-400/20 to-purple-400/20 blur-sm transition-all duration-300 ease-out"]: pathname === "/",
            ["absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-indigo-400/20 to-purple-400/20 blur-sm transition-all duration-300 ease-out group-hover:w-full"]: pathname !== "/",
          }}></span>
        </a>
      </li>
      <li>
        <a
          href="/resume"
          class:list={{
            ["text-white font-medium relative transition-all duration-300 ease-out focus:outline-none"]: pathname === "/resume",
            ["text-gray-300 hover:text-white transition-all duration-300 ease-out relative group focus:outline-none"]: pathname !== "/resume",
          }}
          aria-current={pathname === "/resume" ? "page" : undefined}
        >
          Resume
          <span class:list={{
            ["absolute -bottom-1 left-0 w-full h-0.5 bg-gradient-to-r from-indigo-400 to-purple-400 transition-all duration-300 ease-out"]: pathname === "/resume",
            ["absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-indigo-400 to-purple-400 transition-all duration-300 ease-out group-hover:w-full"]: pathname !== "/resume",
          }}></span>
          <!-- Cool border glow effect -->
          <span class:list={{
            ["absolute -bottom-1 left-0 w-full h-0.5 bg-gradient-to-r from-indigo-400/20 to-purple-400/20 blur-sm transition-all duration-300 ease-out"]: pathname === "/resume",
            ["absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-indigo-400/20 to-purple-400/20 blur-sm transition-all duration-300 ease-out group-hover:w-full"]: pathname !== "/resume",
          }}></span>
        </a>
      </li>
      <li>
        <a
          href="/posts"
          class:list={{
            ["text-white font-medium relative transition-all duration-300 ease-out focus:outline-none"]: pathname === "/posts",
            ["text-gray-300 hover:text-white transition-all duration-300 ease-out relative group focus:outline-none"]: pathname !== "/posts",
          }}
          aria-current={pathname === "/posts" ? "page" : undefined}
        >
          Posts
          <span class:list={{
            ["absolute -bottom-1 left-0 w-full h-0.5 bg-gradient-to-r from-indigo-400 to-purple-400 transition-all duration-300 ease-out"]: pathname === "/posts",
            ["absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-indigo-400 to-purple-400 transition-all duration-300 ease-out group-hover:w-full"]: pathname !== "/posts",
          }}></span>
          <!-- Cool border glow effect -->
          <span class:list={{
            ["absolute -bottom-1 left-0 w-full h-0.5 bg-gradient-to-r from-indigo-400/20 to-purple-400/20 blur-sm transition-all duration-300 ease-out"]: pathname === "/posts",
            ["absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-indigo-400/20 to-purple-400/20 blur-sm transition-all duration-300 ease-out group-hover:w-full"]: pathname !== "/posts",
          }}></span>
        </a>
      </li>
      <li>
        <a
          href="/planned"
          class:list={{
            ["text-white font-medium relative transition-all duration-300 ease-out focus:outline-none"]: pathname === "/planned",
            ["text-gray-300 hover:text-white transition-all duration-300 ease-out relative group focus:outline-none"]: pathname !== "/planned",
          }}
          aria-current={pathname === "/planned" ? "page" : undefined}
        >
          Plans
          <span class:list={{
            ["absolute -bottom-1 left-0 w-full h-0.5 bg-gradient-to-r from-indigo-400 to-purple-400 transition-all duration-300 ease-out"]: pathname === "/planned",
            ["absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-indigo-400 to-purple-400 transition-all duration-300 ease-out group-hover:w-full"]: pathname !== "/planned",
          }}></span>
          <!-- Cool border glow effect -->
          <span class:list={{
            ["absolute -bottom-1 left-0 w-full h-0.5 bg-gradient-to-r from-indigo-400/20 to-purple-400/20 blur-sm transition-all duration-300 ease-out"]: pathname === "/planned",
            ["absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-indigo-400/20 to-purple-400/20 blur-sm transition-all duration-300 ease-out group-hover:w-full"]: pathname !== "/planned",
          }}></span>
        </a>
      </li>
      <li>
        <a
          href="/til"
          class:list={{
            ["text-white font-medium relative transition-all duration-300 ease-out focus:outline-none"]: pathname === "/til",
            ["text-gray-300 hover:text-white transition-all duration-300 ease-out relative group focus:outline-none"]: pathname !== "/til",
          }}
          aria-current={pathname === "/til" ? "page" : undefined}
        >
          TIL
          <span class:list={{
            ["absolute -bottom-1 left-0 w-full h-0.5 bg-gradient-to-r from-indigo-400 to-purple-400 transition-all duration-300 ease-out"]: pathname === "/til",
            ["absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-indigo-400 to-purple-400 transition-all duration-300 ease-out group-hover:w-full"]: pathname !== "/til",
          }}></span>
          <!-- Cool border glow effect -->
          <span class:list={{
            ["absolute -bottom-1 left-0 w-full h-0.5 bg-gradient-to-r from-indigo-400/20 to-purple-400/20 blur-sm transition-all duration-300 ease-out"]: pathname === "/til",
            ["absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-indigo-400/20 to-purple-400/20 blur-sm transition-all duration-300 ease-out group-hover:w-full"]: pathname !== "/til",
          }}></span>
        </a>
      </li>
    </ul>
  </nav>

  <!-- Mobile menu button with Apple glassmorphism -->
  <button 
    id="mobile-menu-button"
    class="md:hidden p-3 rounded-2xl backdrop-blur-2xl bg-white/5 border border-white/10 text-gray-300 hover:text-white hover:bg-white/10 transition-all duration-300 ease-out hover:shadow-lg focus:outline-none"
    aria-label="Toggle mobile menu"
    aria-expanded="false"
    aria-controls="mobile-menu"
  >
    <svg id="menu-icon" class="w-6 h-6 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
    </svg>
    <svg id="close-icon" class="w-6 h-6 hidden transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
    </svg>
  </button>
</header>

<!-- Mobile Navigation Menu -->
<nav 
  id="mobile-menu"
  class="md:hidden fixed inset-x-0 top-[72px] z-40 transform -translate-y-full opacity-0 transition-all duration-300 ease-out pointer-events-none"
  role="navigation" 
  aria-label="Mobile Navigation"
>
  <div class="backdrop-blur-3xl bg-slate-900/95 border-b border-slate-700/50 shadow-2xl">
    <div class="mx-auto w-full max-w-7xl px-4 py-6 sm:px-6 lg:px-8">
      <ul role="list" class="space-y-4">
        <li>
          <a
            href="/"
            class:list={{
              ["block text-white font-medium py-3 px-4 rounded-xl bg-gradient-to-r from-indigo-500/20 to-purple-500/20 border border-indigo-400/30 shadow-lg"]: pathname === "/",
              ["block text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-indigo-500/10 hover:to-purple-500/10 py-3 px-4 rounded-xl transition-all duration-300"]: pathname !== "/",
            }}
            aria-current={pathname === "/" ? "page" : undefined}
          >
            Home
          </a>
        </li>
        <li>
          <a
            href="/resume"
            class:list={{
              ["block text-white font-medium py-3 px-4 rounded-xl bg-gradient-to-r from-indigo-500/20 to-purple-500/20 border border-indigo-400/30 shadow-lg"]: pathname === "/resume",
              ["block text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-indigo-500/10 hover:to-purple-500/10 py-3 px-4 rounded-xl transition-all duration-300"]: pathname !== "/resume",
            }}
            aria-current={pathname === "/resume" ? "page" : undefined}
          >
            Resume
          </a>
        </li>
        <li>
          <a
            href="/posts"
            class:list={{
              ["block text-white font-medium py-3 px-4 rounded-xl bg-gradient-to-r from-indigo-500/20 to-purple-500/20 border border-indigo-400/30 shadow-lg"]: pathname === "/posts",
              ["block text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-indigo-500/10 hover:to-purple-500/10 py-3 px-4 rounded-xl transition-all duration-300"]: pathname !== "/posts",
            }}
            aria-current={pathname === "/posts" ? "page" : undefined}
          >
            Posts
          </a>
        </li>
        <li>
          <a
            href="/planned"
            class:list={{
              ["block text-white font-medium py-3 px-4 rounded-xl bg-gradient-to-r from-indigo-500/20 to-purple-500/20 border border-indigo-400/30 shadow-lg"]: pathname === "/planned",
              ["block text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-indigo-500/10 hover:to-purple-500/10 py-3 px-4 rounded-xl transition-all duration-300"]: pathname !== "/planned",
            }}
            aria-current={pathname === "/planned" ? "page" : undefined}
          >
            Plans
          </a>
        </li>
        <li>
          <a
            href="/til"
            class:list={{
              ["block text-white font-medium py-3 px-4 rounded-xl bg-gradient-to-r from-indigo-500/20 to-purple-500/20 border border-indigo-400/30 shadow-lg"]: pathname === "/til",
              ["block text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-indigo-500/10 hover:to-purple-500/10 py-3 px-4 rounded-xl transition-all duration-300"]: pathname !== "/til",
            }}
            aria-current={pathname === "/til" ? "page" : undefined}
          >
            TIL
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<script>
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = document.getElementById('menu-icon');
  const closeIcon = document.getElementById('close-icon');
  
  if (mobileMenuButton && mobileMenu && menuIcon && closeIcon) {
    let isOpen = false;
    
    mobileMenuButton.addEventListener('click', () => {
      isOpen = !isOpen;
      
      if (isOpen) {
        // Open menu
        mobileMenu.classList.remove('-translate-y-full', 'opacity-0', 'pointer-events-none');
        mobileMenu.classList.add('translate-y-0', 'opacity-100', 'pointer-events-auto');
        menuIcon.classList.add('hidden');
        closeIcon.classList.remove('hidden');
        mobileMenuButton.setAttribute('aria-expanded', 'true');
        
        // Prevent body scroll
        document.body.style.overflow = 'hidden';
      } else {
        // Close menu
        mobileMenu.classList.add('-translate-y-full', 'opacity-0', 'pointer-events-none');
        mobileMenu.classList.remove('translate-y-0', 'opacity-100', 'pointer-events-auto');
        menuIcon.classList.remove('hidden');
        closeIcon.classList.add('hidden');
        mobileMenuButton.setAttribute('aria-expanded', 'false');
        
        // Restore body scroll
        document.body.style.overflow = '';
      }
    });
    
    // Close menu when clicking a link
    const mobileLinks = mobileMenu.querySelectorAll('a');
    mobileLinks.forEach(link => {
      link.addEventListener('click', () => {
        if (isOpen) {
          isOpen = false;
          mobileMenu.classList.add('-translate-y-full', 'opacity-0', 'pointer-events-none');
          mobileMenu.classList.remove('translate-y-0', 'opacity-100', 'pointer-events-auto');
          menuIcon.classList.remove('hidden');
          closeIcon.classList.add('hidden');
          mobileMenuButton.setAttribute('aria-expanded', 'false');
          document.body.style.overflow = '';
        }
      });
    });
    
    // Close menu on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && isOpen) {
        isOpen = false;
        mobileMenu.classList.add('-translate-y-full', 'opacity-0', 'pointer-events-none');
        mobileMenu.classList.remove('translate-y-0', 'opacity-100', 'pointer-events-auto');
        menuIcon.classList.remove('hidden');
        closeIcon.classList.add('hidden');
        mobileMenuButton.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = '';
      }
    });
  }
</script>
